<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProjectMapper">
	<!-- 프로젝트 가져오기 -->
  <select id="ListCategory" resultType="ProjectVo">
  <![CDATA[
	SELECT 
	    NO
	    , IMAGE_URL
	    , CATEGORY_NO
	    , MAIN_CATEGORY
	    , SUB_CATEGORY
	    , MEMBER_NO
	    , NAME
	    , TITLE
	    , REGEXP_REPLACE(REVERSE(REGEXP_REPLACE(REVERSE(TO_CHAR(GOAL_AMOUNT)), '(\d{3})', '\1,')), '^,', '') AS "GOAL_AMOUNT"
	    , REGEXP_REPLACE(REVERSE(REGEXP_REPLACE(REVERSE(TO_CHAR(CURRENT_AMOUNT)), '(\d{3})', '\1,')), '^,', '') AS "CURRENT_AMOUNT"
	    , END_DATE
	FROM (
	        SELECT 
	        P.NO
	        , P.IMAGE_URL
	        , P.CATEGORY_NO
	        , C.MAIN_CATEGORY
	        , C.SUB_CATEGORY
	        , P.MEMBER_NO
	        , M.NAME
	        , P.TITLE
	        , P.END_DATE
	        , P.GOAL_AMOUNT
	        , P.CURRENT_AMOUNT
	    FROM PROJECT P
	        JOIN MEMBER M ON P.MEMBER_NO = M.NO
	        JOIN CATEGORY C ON P.CATEGORY_NO = C.NO
	        JOIN PROJECT_STATUS PS ON P.STATUS_NO = PS.NO
	    WHERE 
	        P.STATUS_NO = 3 
	        OR P.STATUS_NO = 5 
	        OR P.STATUS_NO = 6 
	        OR P.STATUS_NO = 7
	    )
	WHERE CURRENT_AMOUNT*100/GOAL_AMOUNT >=10
	    AND CURRENT_AMOUNT*100/GOAL_AMOUNT <=100
	]]>
  </select>
  
  
</mapper>